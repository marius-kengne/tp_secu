NAT Question6

sudo iptables -t nat -A POSTROUTING -o enp0s3 -j MASQUERADE
sudo iptables -A FORWARD -i enp0s8 -o enp0s3 -j ACCEPT
sudo iptables -A FORWARD -i enp0s3 -o enp0s8 -m state --state ESTABLISHED,RELATED -j ACCEPT
sudo iptables -t nat -L -n -v
sudo iptables -L FORWARD -n -v
ping -c 3 8.8.8.8
curl -I https://www.google.com


question : 8


sudo iptables -P INPUT DROP
sudo iptables -P FORWARD DROP
sudo iptables -P OUTPUT ACCEPT

sudo iptables -A INPUT -i lo -j ACCEPT
sudo iptables -A INPUT -i lo -j ACCEPT
sudo iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
sudo iptables -A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT

sudo iptables -A INPUT -i enp0s8 -p icmp -j ACCEPT



resultat

m2@vm2-VirtualBox:~/Desktop$ sudo iptables -L -n -v
Chain INPUT (policy DROP 161 packets, 12819 bytes)
 pkts bytes target     prot opt in     out     source               destination         
   34  4398 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0           
    0     0 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0           
   46 26942 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            state RELATED,ESTABLISHED
    0     0 ACCEPT     icmp --  enp0s8 *       0.0.0.0/0            0.0.0.0/0           

Chain FORWARD (policy DROP 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
 1439  111K ACCEPT     all  --  enp0s8 enp0s3  0.0.0.0/0            0.0.0.0/0           
 1198 7439K ACCEPT     all  --  enp0s3 enp0s8  0.0.0.0/0            0.0.0.0/0            state RELATED,ESTABLISHED
    0     0 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            state RELATED,ESTABLISHED

Chain OUTPUT (policy ACCEPT 160 packets, 21648 bytes)
 pkts bytes target     prot opt in     out     source               destination         
vm2@vm2-VirtualBox:~/Desktop$ 



sudo iptables -L -n -v



sudo iptables -L INPUT --line-numbers
sudo iptables -L FORWARD --line-numbers

sudo iptables -D INPUT 2

vm2@vm2-VirtualBox:~/Desktop$ sudo iptables -L INPUT --line-numbers
Chain INPUT (policy DROP)
num  target     prot opt source               destination         
1    ACCEPT     all  --  anywhere             anywhere            
2    ACCEPT     all  --  anywhere             anywhere            
3    ACCEPT     all  --  anywhere             anywhere             state RELATED,ESTABLISHED
4    ACCEPT     icmp --  anywhere             anywhere            
vm2@vm2-VirtualBox:~/Desktop$ sudo iptables -L FORWARD --line-numbers
Chain FORWARD (policy DROP)
num  target     prot opt source               destination         
1    ACCEPT     all  --  anywhere             anywhere            
2    ACCEPT     all  --  anywhere             anywhere             state RELATED,ESTABLISHED
3    ACCEPT     all  --  anywhere             anywhere             state RELATED,ESTABLISHED
vm2@vm2-VirtualBox:~/Desktop$ 



question 8

sudo iptables -A INPUT -i enp0s8 -p tcp --dport 443 -m state --state NEW -j ACCEPT
sudo iptables -A INPUT -i enp0s3 -p tcp --dport 443 -m state --state NEW -j ACCEPT

sudo iptables -A INPUT -p tcp --dport 80 -j DROP

# Autoriser HTTPS du LAN vers Internet
sudo iptables -A FORWARD -i enp0s8 -o enp0s3 -p tcp --dport 443 -j ACCEPT

# Bloquer tout le reste du LAN vers Internet
sudo iptables -A FORWARD -i enp0s8 -o enp0s3 -j DROP

curl -I https://www.google.com   # doit marcher ✅
curl -I http://example.com       # doit échouer ❌

sudo iptables -A INPUT -i enp0s3 -p tcp --dport 443 -m state --state NEW -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 80 -j DROP

curl -vk https://10.0.2.15

-----------------  resultqt 
vm2@vm2-VirtualBox:~/Desktop$ sudo iptables -L -n -v
Chain INPUT (policy DROP 164 packets, 13038 bytes)
 pkts bytes target     prot opt in     out     source               destination         
  534  102K ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0           
 2071 1104K ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            state RELATED,ESTABLISHED
    0     0 ACCEPT     icmp --  enp0s8 *       0.0.0.0/0            0.0.0.0/0           
    1    60 ACCEPT     tcp  --  enp0s8 *       0.0.0.0/0            0.0.0.0/0            tcp dpt:443 state NEW
    0     0 ACCEPT     tcp  --  enp0s3 *       0.0.0.0/0            0.0.0.0/0            tcp dpt:443 state NEW
   45  2700 DROP       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80
    0     0 ACCEPT     tcp  --  enp0s3 *       0.0.0.0/0            0.0.0.0/0            tcp dpt:443 state NEW
    0     0 DROP       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80

Chain FORWARD (policy DROP 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
 2774  485K ACCEPT     all  --  enp0s8 enp0s3  0.0.0.0/0            0.0.0.0/0           
 3071 8858K ACCEPT     all  --  enp0s3 enp0s8  0.0.0.0/0            0.0.0.0/0            state RELATED,ESTABLISHED
    0     0 ACCEPT     tcp  --  enp0s8 enp0s3  0.0.0.0/0            0.0.0.0/0            tcp dpt:443
    0     0 DROP       all  --  enp0s8 enp0s3  0.0.0.0/0            0.0.0.0/0           

Chain OUTPUT (policy ACCEPT 2239 packets, 675K bytes)
 pkts bytes target     prot opt in     out     source               destination         
vm2@vm2-VirtualBox:~/Desktop$ sudo iptables -t nat -L -n -v
Chain PREROUTING (policy ACCEPT 316 packets, 46297 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain INPUT (policy ACCEPT 11 packets, 886 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain OUTPUT (policy ACCEPT 1568 packets, 342K bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain POSTROUTING (policy ACCEPT 526 packets, 40995 bytes)
 pkts bytes target     prot opt in     out     source               destination         
  608  113K MASQUERADE  all  --  *      enp0s3  0.0.0.0/0            0.0.0.0/0           
vm2@vm2-VirtualBox:~/Desktop$ 



##### question 9

sudo iptables -A INPUT -j LOG --log-prefix "FIREWALL_DROP_IN: " --log-level 4
sudo iptables -L INPUT -n –v

sudo apt install iptables-persistent –y
sudo netfilter-persistent save
sudo cat /etc/iptables/rules.v4

sudo reboot

sudo iptables -L -n -v
sudo iptables -t nat -L -n -v

on client :
ping -c 3 8.8.8.8
curl -I https://www.google.com


On client :
curl -vk https://192.168.10.1
on server :

curl -vk https://10.0.2.15

verif finale :
sudo iptables -L -n -v
sudo iptables -t nat -L -n -v
